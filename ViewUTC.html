<!DOCTYPE html>
<html lang="en">
<!--
 __     __   __  _   _  __    _                      __  _____    ____  __                           
 \ \   / /  / / | | | | \ \  (_)   ___  __      __  / / |_   _|  / ___| \ \                          
  \ \ / /  | |  | | | |  | | | |  / _ \ \ \ /\ / / | |    | |   | |      | |                         
   \ V /   | |  | |_| |  | | | | |  __/  \ V  V /  | |    | |   | |___   | |                         
    \_/    | |   \___/   | | |_|  \___|   \_/\_/   | |    |_|    \____|  | |                         
     _      \_\     _   /_/ _                 _     \_\         _       /_/                        _ 
    / \       ___  (_) | | | |  _   _      __| |   __ _   ___  | |__   | |__     ___    _ __    __| |
   / G \     / __| | | | | | | | | | |    / G` |  / G` | / __| | '_ \  | '_ \   / G \  | '__|  / G` |
  / ___ \    \__ \ | | | | | | | |_| |   | (_| | | (_| | \__ \ | | | | | |_) | | (_) | | |    | (_| |
 /_/   \_\   |___/ |_| |_| |_|  \__, |    \__,_|  \__,_| |___/ |_| |_| |_.__/   \___/  |_|     \__,_|
-->

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>V(U)iew(TC) Version GHv2.0</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: black;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      text-align: center;
      padding: 2vh 2vw;
      box-sizing: border-box;
    }
    #title {
      font-size: 50px;
      font-weight: bold;
      margin-bottom: 20px;
      color: white;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 2fr);
      column-gap: 60px;
      row-gap: 20px;
      width: 70%;
      max-width: 1200px;
    }
    .box {
      width: 100%;
      padding: 10px;
      border: 1px solid #444;
      background-color: #222;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
    }
    #k-index {
      font-size: 17px;
      white-space: pre-wrap;
      text-align: center;
      color: white;
      height: 200px;
      width: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }
    #clock {
      font-size: 60px;
      font-weight: bold;
      margin: 0;
      color: white;
    }
    #date {
      font-size: 30px;
      margin: 0;
      color: white;
    }
    #SFI-A-SN {
      font-size: 18px;
      white-space: pre-wrap;
      text-align: left;
      color: white;
      line-height: 1.2;
    }
    #SFI-A-SN span {
      display: block;
    }
    .band-table {
      width: 70%;
      border-collapse: collapse;
      margin-top: 10px;
      color: white;
    }
    .band-table th, .band-table td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }
    .band-table th {
      background-color: #333;
      color: white;
    }
    .good { background-color: #4CAF50; color: black; }
    .fair { background-color: #FFEB3B; color: black; }
    .poor { background-color: #F44336; color: black; }
    #fullscreen-message {
      font-size: 14px;
      color: yellow;
      margin-top: 30px;
    }
    #qrz-search {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    #qrz-input {
      padding: 8px;
      font-size: 16px;
      width: 80%;
      max-width: 200px;
      border: 1px solid #444;
      border-radius: 4px;
      background-color: #333;
      color: white;
    }
    #qrz-button {
      padding: 8px 16px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #qrz-button:hover {
      background-color: #45a049;
    }
    #solar-image-container {
      text-align: center;
    }
    #solar-image {
      max-width: 100%;
      max-height: 200px;
      border-radius: 1px;
    }
  </style>
</head>
<body>
  <div id="title">V(U)iew(TC) - A Silly Little Dashboard</div>
  <div class="grid-container">
    <div class="box">
      <div id="k-index">Downloading K-index...</div>
    </div>
    <div class="box">
      <div id="clock">00:00:00</div>
      <div id="date">16 FEB 25</div>
    </div>
    <div class="box">
      <table class="band-table">
        <thead>
          <tr>
            <th>Band</th>
            <th>Day</th>
            <th>Night</th>
          </tr>
        </thead>
        <tbody id="bandTable"></tbody>
      </table>
    </div>
    <div class="box">
      <div id="SFI-A-SN"><span id="sfi-value">Downloading SFI...</span><span id="a-index-value">Downloading A-Index...</span><span id="sunspot-value">Downloading Sunspot Number...</span><span id="d-layer-value">Downloading D-Layer Absorption...</span></div>
    </div>
    <div class="box">
      <div id="solar-image-container">
        <img id="solar-image" src="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_512_0171.jpg" alt="Latest Solar Image">
      </div>
    </div>
    <div class="box">
      <div id="qrz-search">
        <input type="text" id="qrz-input" placeholder="Enter callsign (e.g., LB6QJ)">
        <button id="qrz-button" onclick="searchQRZ()">Search QRZ</button>
      </div>
    </div>
  </div>
  <div id="fullscreen-message">
    //Please open the dashboard in fullscreen for the best viewing experience// <br>
    For the latest update visit <a href="https://github.com/rSignal86/ViewUTC">rSignal86:ViewUTC</a><br> 
    Current version is GHv2.0   73 de LB6QJ
  </div>
  <script>
    function getTimestamp() {
      const now = new Date();
      return `[${now.toLocaleDateString()} ${now.toLocaleTimeString()}]`;
    }

    console.log(getTimestamp(), "WELCOME TO THE V(U)iew(TC) dashboard!, NEW UPDATE IS IN  https://github.com/rSignal86/ViewUTC. THIS PROGRAM DOWNLOADS ONLY DATA FROM DIFFRENT SOURCES AND DISPLAY THEM IN A NICE WAY. IT DOES NOT SAVE ANYTHING WHEN YOU CLOSE THE WINDOW AND THIS PROGRAM DOES NOT LOOKING FOR PERSONAL AND COMPUTER INFORMATION AND SEND IT TO ANYONE.");

    const monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];

    function updateClock() {
      const now = new Date();
      const utcHours = now.getUTCHours().toString().padStart(2, '0');
      const utcMinutes = now.getUTCMinutes().toString().padStart(2, '0');
      const utcSeconds = now.getUTCSeconds().toString().padStart(2, '0');
      document.getElementById('clock').textContent = `${utcHours}:${utcMinutes}:${utcSeconds}`;
      const utcDay = now.getUTCDate().toString().padStart(2, '0');
      const utcMonth = monthNames[now.getUTCMonth()];
      const utcYear = now.getUTCFullYear().toString().slice(-2);
      document.getElementById('date').textContent = `${utcDay} ${utcMonth} ${utcYear}`;
    }

    async function fetchKpIndex() {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/text/3-day-geomag-forecast.txt');
        if (!response.ok) throw new Error("Network response was not OK");
        const text = await response.text();
        const lines = text.split('\n');
        const startIndex = lines.findIndex(line => line.includes("NOAA Kp index forecast"));
        document.getElementById('k-index').textContent = startIndex !== -1 ? lines.slice(startIndex).join('\n') : "Could not find K-index.";
        console.log(getTimestamp(), "K-index updated.");
      } catch (error) {
        console.error(getTimestamp(), "ERROR fetching K-index:", error);
        document.getElementById('k-index').textContent = 'Error fetching K-Index';
      }
    }

    async function fetchSFI() {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/text/wwv.txt');
        if (!response.ok) throw new Error("Network response was not OK");
        const text = await response.text();
        const lines = text.split('\n');
        for (let line of lines) {
          if (line.includes("Solar flux")) {
            const parts = line.split(' ').filter(part => part.trim() !== '');
            return parts[2];
          }
        }
        throw new Error("SFI not found in response.");
      } catch (error) {
        console.error(getTimestamp(), "ERROR fetching SFI:", error);
        return 'Error fetching SFI';
      }
    }

    async function fetchAIndex() {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/text/wwv.txt');
        if (!response.ok) throw new Error("Network response was not OK");
        const text = await response.text();
        const lines = text.split('\n');
        for (let line of lines) {
          if (line.includes("A-index")) {
            const parts = line.split(' ').filter(part => part.trim() !== '');
            return parts[parts.length - 1];
          }
        }
        throw new Error("A-index not found in response.");
      } catch (error) {
        console.error(getTimestamp(), "ERROR fetching A-Index:", error);
        return 'Error fetching A-Index';
      }
    }

    async function fetchSunspotNumber() {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/json/solar-cycle/observed-solar-cycle-indices.json');
        if (!response.ok) throw new Error("Network response was not OK");
        const data = await response.json();
        return data[data.length - 1].ssn;
      } catch (error) {
        console.error(getTimestamp(), "ERROR fetching Sunspot Number:", error);
        return 'Error fetching Sunspot Number';
      }
    }

    function calculateDLayerAbsorption(aIndex) {
      const aIndexNum = parseInt(aIndex);
      if (isNaN(aIndexNum)) return "Unknown";
      if (aIndexNum <= 10) return "Low";
      if (aIndexNum <= 25) return "Moderate";
      console.log(getTimestamp(), "D-Layer Absorption calculated:", aIndexNum <= 10 ? "Low" : aIndexNum <= 25 ? "Moderate" : "High");
      return "High";
    }

    async function updateDataLine() {
      try {
        const sfi = await fetchSFI();
        const aIndex = await fetchAIndex();
        const sunspotNumber = await fetchSunspotNumber();
        const dLayerAbsorption = calculateDLayerAbsorption(aIndex);
        document.getElementById('sfi-value').textContent = `SFI: ${sfi}`;
        document.getElementById('a-index-value').textContent = `A-Index: ${aIndex}`;
        document.getElementById('sunspot-value').textContent = `Sunspot Number: ${sunspotNumber}`;
        document.getElementById('d-layer-value').textContent = `D-Layer Absorption: ${dLayerAbsorption}`;
        console.log(getTimestamp(), "Data update complete.");
      } catch (error) {
        console.error(getTimestamp(), "ERROR in updateDataLine:", error);
      }
    }

    function calculateBandConditions(solarFlux) {
      return [
        { name: "80-40m", day: "poor", night: "good" },
        { name: "30-20m", day: solarFlux >= 100 && solarFlux < 150 ? "good" : solarFlux >= 70 && solarFlux < 100 ? "fair" : "poor", night: "poor" },
        { name: "17-15m", day: solarFlux >= 100 && solarFlux < 150 ? "good" : solarFlux >= 70 && solarFlux < 100 ? "fair" : "poor", night: "poor" },
        { name: "12-10m", day: solarFlux >= 150 ? "good" : solarFlux >= 100 && solarFlux < 150 ? "fair" : "poor", night: "poor" }
      ];
    }

    function displayBandConditions() {
      try {
        const bands = calculateBandConditions(120);
        if (!Array.isArray(bands) || bands.length === 0) {
          throw new Error("Invalid band conditions data");
        }
        const bandTable = document.getElementById('bandTable');
        if (!bandTable) {
          throw new Error("Band table element not found");
        }
        bandTable.innerHTML = '';
        bands.forEach(band => {
          if (!band.name || !band.day || !band.night) {
            throw new Error("Incomplete band data");
          }
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${band.name}</td>
            <td class="${band.day}">${band.day === "good" ? "Good" : band.day === "fair" ? "Fair" : "Poor"}</td>
            <td class="${band.night}">${band.night === "good" ? "Good" : band.night === "fair" ? "Fair" : "Poor"}</td>
          `;
          bandTable.appendChild(row);
        });
        console.log(getTimestamp(), "Band conditions calculated and loaded successfully.");
      } catch (error) {
        console.error(getTimestamp(), "ERROR in displayBandConditions:", error);
      }
    }

    function searchQRZ() {
      const callsign = document.getElementById('qrz-input').value.trim().toUpperCase();
      if (callsign) {
        window.open(`https://www.qrz.com/db/${callsign}`, '_blank');
        console.log(getTimestamp(), `Searching QRZ for callsign: ${callsign}`);
      } else {
        console.error(getTimestamp(), "ERROR: No callsign entered.");
      }
    }

    function updateSolarImage() {
      const solarImage = document.getElementById('solar-image');
      const timestamp = new Date().getTime();
      const newSrc = `https://sdo.gsfc.nasa.gov/assets/img/latest/latest_512_0171.jpg?${timestamp}`;
      
      solarImage.onload = function() {
        console.log(getTimestamp(), "Solar image loaded successfully.");
      };
      solarImage.onerror = function() {
        console.error(getTimestamp(), "ERROR loading solar image.");
      };
      
      solarImage.src = newSrc;
    }

    document.getElementById('qrz-input').addEventListener('keypress', function(event) {
      if (event.key === 'Enter') searchQRZ();
    });

    setInterval(updateClock, 1000);
    updateClock();
    updateSolarImage();
    setInterval(fetchKpIndex, 3600000);
    setInterval(updateDataLine, 3600000);
    setInterval(updateSolarImage, 900000);
    fetchKpIndex();
    updateDataLine();
    displayBandConditions();
  </script>
</body>
</html>
