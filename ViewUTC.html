<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>V(U)iew(TC) Version GHv1.0</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: black;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      text-align: center;
      padding: 2vh 2vw;
      box-sizing: border-box;
    }
    #title {
      font-size: 50px;
      font-weight: bold;
      margin-bottom: 20px;
      color: white;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 60px;
      width: 90%;
      max-width: 1200px;
    }
    .box {
      width: 100%;
      padding: 20px;
      border: 1px solid #444;
      background-color: #222;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
    }
    #k-index {
      font-size: 18px;
      white-space: pre-wrap;
      text-align: left;
      color: white;
    }
    #clock {
      font-size: 60px;
      font-weight: bold;
      margin: 0;
      color: white;
    }
    #date {
      font-size: 30px;
      margin: 0;
      color: white;
    }
    #SFI-A-SN {
      font-size: 18px;
      white-space: pre-wrap;
      margin-top: 10px;
      color: white;
    }
    .band-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      color: white;
    }
    .band-table th, .band-table td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }
    .band-table th {
      background-color: #333;
      color: white;
    }
    /* COLORS FOR BAND CONDITIONS */
    .good { background-color: #4CAF50; color: black; }
    .fair { background-color: #FFEB3B; color: black; }
    .poor { background-color: #F44336; color: black; }
    #fullscreen-message {
      display: none;
      font-size: 18px;
      color: yellow;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div id="title">V(U)iew(TC) - A Silly Little Dashboard</div>
  <div class="grid-container">
    <div class="box">
      <div id="k-index">Downloading K-index...</div>
    </div>
    <div class="box">
      <div id="clock">00:00:00</div>
      <div id="date">16 FEB 25</div>
      <div id="SFI-A-SN">Downloading SFI, A-Index, and Sunspot Number...</div>
    </div>
    <div class="box">
      <table class="band-table">
        <thead>
          <tr>
            <th>Band</th>
            <th>Day</th>
            <th>Night</th>
          </tr>
        </thead>
        <tbody id="bandTable"></tbody>
      </table>
    </div>
  </div>
  <div id="fullscreen-message">
    //Please open the dashboard in fullscreen for the best viewing experience//
  </div>
  <script>
    // FUNCTION TO GET TIMESTAMP (DATE AND TIME)
    function getTimestamp() {
      const now = new Date();
      const date = now.toLocaleDateString();
      const time = now.toLocaleTimeString();
      return `[${date} ${time}]`;
    }

    /* CUSTOM MESSAGE - EDIT THIS TEXT AS NEEDED */
    const customMessage = "Welcome to the V(U)iew(TC) dashboard!";
    console.log(getTimestamp(), customMessage);

    const monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];

    // SET YOUR CUSTOM DATE (UTC) IN "YYYY-MM-DD" FORMAT
    const CUSTOM_DATE = "2025-02-22"; // CHANGE THIS VALUE AS NEEDED

    // UPDATE THE UTC CLOCK AND DATE, AND CHECK IF TODAY MATCHES THE CUSTOM DATE
    function updateClock() {
      try {
        const now = new Date();
        const utcHours = now.getUTCHours().toString().padStart(2, '0');
        const utcMinutes = now.getUTCMinutes().toString().padStart(2, '0');
        const utcSeconds = now.getUTCSeconds().toString().padStart(2, '0');
        document.getElementById('clock').textContent = `${utcHours}:${utcMinutes}:${utcSeconds}`;

        const utcDay = now.getUTCDate().toString().padStart(2, '0');
        const utcMonth = monthNames[now.getUTCMonth()];
        const utcYear = now.getUTCFullYear().toString().slice(-2);
        document.getElementById('date').textContent = `${utcDay} ${utcMonth} ${utcYear}`;

        // CHECK IF THE CURRENT DATE (UTC) MATCHES THE CUSTOM_DATE
        const currentDate = now.toISOString().split('T')[0]; // "YYYY-MM-DD"
        if (currentDate !== CUSTOM_DATE) {
          console.error(getTimestamp(), "ERROR: The current date (" + currentDate + ") does not match the expected date (" + CUSTOM_DATE + ").");
        }
      } catch (error) {
        console.error(getTimestamp(), "ERROR in updateClock:", error);
      }
    }
	
    async function fetchKpIndex() {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/text/3-day-geomag-forecast.txt');
        if (!response.ok) throw new Error("Network response was not OK");
        const text = await response.text();
        const lines = text.split('\n');
        let kpForecast = "Could not find K-index.";

        const startIndex = lines.findIndex(line => line.includes("NOAA Kp index forecast"));
        if (startIndex !== -1) {
          kpForecast = lines.slice(startIndex).join('\n');
        } else {
          console.error(getTimestamp(), "ERROR: 'NOAA Kp index forecast' not found in data.");
        }

        document.getElementById('k-index').textContent = kpForecast;
        console.log(getTimestamp(), "K-index updated.");
      } catch (error) {
        console.error(getTimestamp(), "ERROR fetching K-index:", error);
        document.getElementById('k-index').textContent = 'Error fetching K-Index';
      }
    }

    async function fetchSFI() {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/text/wwv.txt');
        if (!response.ok) throw new Error("Network response was not OK");
        const text = await response.text();
        const lines = text.split('\n');
        let sfi = "N/A";

        for (let line of lines) {
          if (line.includes("Solar flux")) {
            const parts = line.split(' ').filter(part => part.trim() !== '');
            sfi = parts[2];
            break;
          }
        }
        
        if (sfi === "N/A") throw new Error("SFI not found in response.");
        console.log(getTimestamp(), "SFI updated.");
        return sfi;
      } catch (error) {
        console.error(getTimestamp(), "ERROR fetching SFI:", error);
        return 'Error fetching SFI';
      }
    }

    async function fetchAIndex() {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/text/wwv.txt');
        if (!response.ok) throw new Error("Network response was not OK");
        const text = await response.text();
        const lines = text.split('\n');
        let aIndex = "N/A";

        for (let line of lines) {
          if (line.includes("A-index")) {
            const parts = line.split(' ').filter(part => part.trim() !== '');
            aIndex = parts[parts.length - 1];
            break;
          }
        }
        
        if (aIndex === "N/A") throw new Error("A-index not found in response.");
        console.log(getTimestamp(), "A-Index updated.");
        return aIndex;
      } catch (error) {
        console.error(getTimestamp(), "ERROR fetching A-Index:", error);
        return 'Error fetching A-Index';
      }
    }

    async function fetchSunspotNumber() {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/json/solar-cycle/observed-solar-cycle-indices.json');
        if (!response.ok) throw new Error("Network response was not OK");
        const data = await response.json();
        const latestData = data[data.length - 1];

        if (!latestData || !latestData.ssn) throw new Error("Sunspot Number not found.");
        console.log(getTimestamp(), "Sunspot Number updated.");
        return latestData.ssn;
      } catch (error) {
        console.error(getTimestamp(), "ERROR fetching Sunspot Number:", error);
        return 'Error fetching Sunspot Number';
      }
    }

    async function updateDataLine() {
      try {
        const sfi = await fetchSFI();
        const aIndex = await fetchAIndex();
        const sunspotNumber = await fetchSunspotNumber();
        document.getElementById('SFI-A-SN').textContent = `SFI: ${sfi} | A-Index: ${aIndex} | Sunspot Number: ${sunspotNumber}`;
        console.log(getTimestamp(), "Data update complete.");
      } catch (error) {
        console.error(getTimestamp(), "ERROR in updateDataLine:", error);
      }
    }

    // FUNCTION TO CALCULATE BAND CONDITIONS BASED ON SOLAR FLUX
    function calculateBandConditions(solarFlux) {
      return [
        { name: "80-40m", day: "poor", night: "good" },
        { name: "30-20m", day: solarFlux >= 100 && solarFlux < 150 ? "good" : solarFlux >= 70 && solarFlux < 100 ? "fair" : "poor", night: "poor" },
        { name: "17-15m", day: solarFlux >= 100 && solarFlux < 150 ? "good" : solarFlux >= 70 && solarFlux < 100 ? "fair" : "poor", night: "poor" },
        { name: "12-10m", day: solarFlux >= 150 ? "good" : solarFlux >= 100 && solarFlux < 150 ? "fair" : "poor", night: "poor" }
      ];
    }

    // FUNCTION TO DISPLAY BAND CONDITIONS IN THE TABLE
    function displayBandConditions() {
      try {
        const bands = calculateBandConditions(120);
        const bandTable = document.getElementById('bandTable');
        bandTable.innerHTML = '';

        bands.forEach(band => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${band.name}</td>
            <td class="${band.day}">${band.day === "good" ? "Good" : band.day === "fair" ? "Fair" : "Poor"}</td>
            <td class="${band.night}">${band.night === "good" ? "Good" : band.night === "fair" ? "Fair" : "Poor"}</td>
          `;
          bandTable.appendChild(row);
        });
        console.log(getTimestamp(), "Band conditions updated in table.");
      } catch (error) {
        console.error(getTimestamp(), "ERROR in displayBandConditions:", error);
      }
    }

    // FUNCTION TO CHECK IF PAGE IS IN FULLSCREEN MODE
    function checkFullscreen() {
      document.getElementById('fullscreen-message').style.display = document.fullscreenElement ? 'none' : 'block';
    }

    // START UPDATES
    setInterval(updateClock, 1000);
    updateClock();

    fetchKpIndex();
    updateDataLine();
    displayBandConditions();

    setInterval(fetchKpIndex, 3600000);
    setInterval(updateDataLine, 3600000);

    window.addEventListener('load', checkFullscreen);
    window.addEventListener('resize', checkFullscreen);
  </script>
</body>
</html>
