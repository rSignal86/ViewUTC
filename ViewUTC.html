<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>V(U)iew(TC) Version GHv2.2</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: black;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 2vh 2vw;
      box-sizing: border-box;
      text-align: center;
    }
    #title {
      font-size: 50px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 2fr);
      column-gap: 60px;
      row-gap: 20px;
      width: 70%;
      max-width: 1200px;
    }
    .box {
      width: 100%;
      padding: 10px;
      border: 1px solid #444;
      background-color: #222;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    #k-index { /* Displays K-index data */
      font-size: 17px;
      white-space: pre-wrap;
      height: 200px;
      width: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }
    #clock { /* Shows current UTC time */
      font-size: 60px;
      font-weight: bold;
      margin: 0;
    }
    #date { /* Shows current UTC date */
      font-size: 30px;
      margin: 0;
    }
    #SFI-A-SN { /* Displays solar data and speech buttons */
      font-size: 18px;
      text-align: left;
      line-height: 1;
      width: 100%; /* Ensure it takes full width of the box */
    }
    #SFI-A-SN span {
      display: block;
      margin: 0;
    }
    .band-table { /* Shows HF band conditions */
      width: 100%;
      border-collapse: collapse;
    }
    .band-table th, .band-table td {
      padding: 3px;
      text-align: center;
      border: 1px solid #ddd;
    }
    .band-table th {
      background-color: #333;
    }
    .good {
      background-color: #4CAF50;
      color: black;
    }
    .fair {
      background-color: #FFEB3B;
      color: black;
    }
    .poor {
      background-color: #F44336;
      color: black;
    }
    #fullscreen-message { /* Footer with usage info */
      font-size: 14px;
      color: yellow;
      margin-top: 30px;
    }
    #qrz-search { /* QRZ lookup tool */
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    #qrz-input {
      padding: 8px;
      font-size: 16px;
      width: 80%;
      max-width: 200px;
      border: 1px solid #444;
      border-radius: 4px;
      background-color: #333;
      color: white;
    }
    #qrz-button {
      padding: 8px 16px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #qrz-button:hover {
      background-color: #45a049;
    }
    #solar-image { /* Displays latest solar image */
      max-width: 100%;
      max-height: 200px;
      border-radius: 1px;
      cursor: pointer;
      transition: max-height 0.3s ease;
    }
    #solar-image.enlarged {
      max-height: 400px;
    }
    .speak-buttons-container { /* Container for horizontal speech buttons */
      display: flex;
      flex-direction: row;
      flex-wrap: wrap; /* Allows wrapping if space is tight */
      gap: 10px; /* Space between buttons */
      margin-top: 10px; /* Space between text and buttons */
    }
    .speak-button { /* Generic style for speech buttons */
      padding: 5px 10px;
      font-size: 14px;
      background-color: #1a1a1a; /* Nearly black for better contrast */
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 110px; /* Smaller width to match shorter text */
    }
    .speak-button:hover {
      background-color: #333; /* Slightly lighter on hover */
    }
  </style>
</head>
<body>
  <div id="title">V(U)iew(TC) - A Silly Little Dashboard</div>
  <div class="grid-container">
    <div class="box"><div id="k-index">Downloading K-index...</div></div>
    <div class="box"><div id="clock">00:00:00</div><div id="date">28 FEB 25</div></div>
    <div class="box">
      <table class="band-table">
        <thead><tr><th>Band</th><th>Status</th></tr></thead>
        <tbody>
          <tr><td>160m (1.8 MHz)</td><td id="band160">Loading...</td></tr>
          <tr><td>80m (3.5 MHz)</td><td id="band80">Loading...</td></tr>
          <tr><td>40m (7 MHz)</td><td id="band40">Loading...</td></tr>
          <tr><td>30m (10.1 MHz)</td><td id="band30">Loading...</td></tr>
          <tr><td>20m (14 MHz)</td><td id="band20">Loading...</td></tr>
          <tr><td>15m (21 MHz)</td><td id="band15">Loading...</td></tr>
          <tr><td>10m (28 MHz)</td><td id="band10">Loading...</td></tr>
        </tbody>
      </table>
    </div>
    <div class="box">
      <div id="SFI-A-SN">
        <span id="sfi-value">Downloading SFI...</span>
        <span id="a-index-value">Downloading A-Index...</span>
        <span id="sunspot-value">Downloading Sunspot Number...</span>
        <span id="d-layer-value">Downloading D-Layer Absorption...</span>
        <div class="speak-buttons-container">
          <button id="speak-sfi-button" class="speak-button">Say: SFI</button>
          <button id="speak-a-index-button" class="speak-button">Say: A-Index</button>
          <button id="speak-sunspot-button" class="speak-button">Say: Sunspot</button>
          <button id="speak-kp-button" class="speak-button">Say: Kp-Index</button>
          <button id="speak-d-layer-button" class="speak-button">Say: D-Layer</button>
        </div>
      </div>
    </div>
    <div class="box"><img id="solar-image" src="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_512_0171.jpg" alt="Latest Solar Image"></div>
    <div class="box"><div id="qrz-search"><input type="text" id="qrz-input" placeholder="Enter callsign (e.g., LB6QJ)"><button id="qrz-button" onclick="searchQRZ()">Search QRZ.com</button></div></div>
  </div>
  <div id="fullscreen-message">
    //Please open the dashboard in fullscreen for the best viewing experience// <br>
    For the latest update visit <a href="https://github.com/rSignal86/ViewUTC">rSignal86:ViewUTC</a>
    Current version is GHv2.2 <br> 73 de LB6QJ
  </div>

  <script>
    const monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];

    // Logs timestamp for debugging
    const getTimestamp = () => `[${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}]`;

    // Updates UTC clock and date
    const updateClock = () => {
      const now = new Date();
      document.getElementById('clock').textContent = `${now.getUTCHours().toString().padStart(2, '0')}:${now.getUTCMinutes().toString().padStart(2, '0')}:${now.getUTCSeconds().toString().padStart(2, '0')}`;
      document.getElementById('date').textContent = `${now.getUTCDate().toString().padStart(2, '0')} ${monthNames[now.getUTCMonth()]} ${now.getUTCFullYear().toString().slice(-2)}`;
    };

    // Fetches and displays K-index forecast
    const fetchKpIndex = async () => {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/text/3-day-geomag-forecast.txt');
        if (!response.ok) throw new Error("Network error");
        const text = await response.text();
        const lines = text.split('\n');
        const startIndex = lines.findIndex(line => line.includes("NOAA Kp index forecast"));
        document.getElementById('k-index').textContent = startIndex !== -1 ? lines.slice(startIndex).join('\n') : "Could not find K-index.";
        console.log(getTimestamp(), "K-index updated.");
      } catch (error) {
        console.error(getTimestamp(), "Error fetching K-index:", error);
        document.getElementById('k-index').textContent = 'Error fetching K-index';
      }
    };

    // Fetches Solar Flux Index (SFI)
    const fetchSFI = async () => {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/text/wwv.txt');
        if (!response.ok) throw new Error("Could not fetch SFI");
        const text = await response.text();
        return text.split('\n').find(line => line.includes("Solar flux"))?.split(' ').filter(Boolean)[2] || "Unknown";
      } catch (error) {
        console.error(getTimestamp(), "Error fetching SFI:", error);
        return "Error";
      }
    };

    // Fetches current Kp-index value
    const fetchKpValue = async () => {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/text/3-day-geomag-forecast.txt');
        if (!response.ok) throw new Error("Could not fetch Kp-index");
        const text = await response.text();
        const lines = text.split('\n');
        const kpHeaderIndex = lines.findIndex(line => line.includes("NOAA Kp index forecast"));
        if (kpHeaderIndex === -1) return "Unknown";
        const kpValues = lines.slice(kpHeaderIndex + 2, kpHeaderIndex + 10).map(line => line.trim().split(/\s+/)[1]).filter(Boolean);
        return kpValues[Math.floor(new Date().getUTCHours() / 3)] || "Unknown";
      } catch (error) {
        console.error(getTimestamp(), "Error fetching Kp-index:", error);
        return "Unknown";
      }
    };

    // Fetches Sunspot Number
    const fetchSunspotNumber = async () => {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/json/solar-cycle/observed-solar-cycle-indices.json');
        if (!response.ok) throw new Error("Could not fetch sunspots");
        const data = await response.json();
        return data[data.length - 1].ssn;
      } catch (error) {
        console.error(getTimestamp(), "Error fetching Sunspot Number:", error);
        return "Error";
      }
    };

    // Fetches A-index
    const fetchAIndex = async () => {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/text/wwv.txt');
        if (!response.ok) throw new Error("Could not fetch A-index");
        const text = await response.text();
        return text.split('\n').find(line => line.includes("A-index"))?.split(' ').filter(Boolean).pop() || "Error";
      } catch (error) {
        console.error(getTimestamp(), "Error fetching A-index:", error);
        return "Error";
      }
    };

    // Calculates D-Layer Absorption based on A-index
    const calculateDLayerAbsorption = aIndex => {
      const aIndexNum = parseInt(aIndex);
      return isNaN(aIndexNum) ? "Unknown" : aIndexNum <= 10 ? "Low" : aIndexNum <= 25 ? "Moderate" : "High";
    };

    // Updates solar data and band conditions
    const updateSolarData = async () => {
      try {
        const [sfi, kp, sunspots, aIndex] = await Promise.all([fetchSFI(), fetchKpValue(), fetchSunspotNumber(), fetchAIndex()]);
        const dLayer = calculateDLayerAbsorption(aIndex);
        document.getElementById("sfi-value").textContent = `SFI: ${sfi}`;
        document.getElementById("a-index-value").textContent = `A-Index: ${aIndex}`;
        document.getElementById("sunspot-value").textContent = `Sunspot Number: ${sunspots}`;
        document.getElementById("d-layer-value").textContent = `D-Layer Absorption: ${dLayer}`;
        window.currentSfi = sfi; // Store SFI for speech
        window.currentKp = kp; // Store Kp for speech
        window.currentSunspots = sunspots; // Store Sunspots for speech
        window.currentAIndex = aIndex; // Store A-Index for speech
        window.currentDLayer = dLayer; // Store D-Layer for speech
        updateBandConditions(sfi, kp);
        console.log(getTimestamp(), `Data updated: SFI=${sfi}, Kp=${kp}, Sunspots=${sunspots}, A-Index=${aIndex}, D-Layer=${dLayer}`);
      } catch (error) {
        console.error(getTimestamp(), "Error updating solar data:", error);
      }
    };

    // Updates HF band conditions based on SFI and Kp
    const updateBandConditions = (sfi, kp) => {
      const sfiNum = parseFloat(sfi), kpNum = parseFloat(kp);
      const conditions = { good: { text: "Good", class: "good" }, medium: { text: "Fair", class: "medium" }, bad: { text: "Poor", class: "bad" } };
      const setStatus = (id, status) => { const cell = document.getElementById(id); cell.textContent = status.text; cell.className = status.class === "good" ? "good" : status.class === "medium" ? "fair" : "poor"; };
      setStatus("band160", kpNum > 4 ? conditions.bad : sfiNum < 70 ? conditions.good : conditions.medium);
      setStatus("band80", kpNum > 4 ? conditions.bad : sfiNum < 70 ? conditions.good : conditions.medium);
      setStatus("band40", kpNum > 4 ? conditions.bad : sfiNum < 70 ? conditions.good : conditions.medium);
      setStatus("band30", kpNum > 5 ? conditions.bad : sfiNum >= 70 && sfiNum <= 130 ? conditions.good : conditions.medium);
      setStatus("band20", kpNum > 5 ? conditions.medium : sfiNum > 100 ? conditions.good : conditions.medium);
      setStatus("band15", kpNum > 6 ? conditions.medium : sfiNum > 100 ? conditions.good : conditions.bad);
      setStatus("band10", kpNum > 6 ? conditions.medium : sfiNum > 130 ? conditions.good : conditions.bad);
    };

    // Opens QRZ lookup in new tab
    const searchQRZ = () => {
      const callsign = document.getElementById('qrz-input').value.trim().toUpperCase();
      if (callsign) { window.open(`https://www.qrz.com/db/${callsign}`, '_blank'); console.log(getTimestamp(), `Searching QRZ for ${callsign}`); }
      else console.error(getTimestamp(), "Error: No callsign entered.");
    };

    // Updates solar image with timestamp to avoid caching
    const updateSolarImage = () => document.getElementById('solar-image').src = `https://sdo.gsfc.nasa.gov/assets/img/latest/latest_512_0171.jpg?${new Date().getTime()}`;

    // Toggles solar image size on click
    const toggleSolarImageSize = () => {
      const solarImage = document.getElementById('solar-image');
      solarImage.classList.toggle('enlarged');
      console.log(getTimestamp(), `Solar image size toggled: ${solarImage.classList.contains('enlarged') ? 'Enlarged' : 'Normal'}`);
    };

    // Reads SFI aloud using Web Speech API
    const speakSfi = () => {
      const sfiValue = window.currentSfi || "Unknown";
      const utterance = new SpeechSynthesisUtterance(`solar flux as of this time is ${sfiValue}`);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
      console.log(getTimestamp(), `Speaking SFI: ${sfiValue}`);
    };

    // Reads A-Index aloud using Web Speech API
    const speakAIndex = () => {
      const aIndexValue = window.currentAIndex || "Unknown";
      const utterance = new SpeechSynthesisUtterance(`A-Index as of this time is ${aIndexValue}`);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
      console.log(getTimestamp(), `Speaking A-Index: ${aIndexValue}`);
    };

    // Reads Sunspot Number aloud using Web Speech API
    const speakSunspot = () => {
      const sunspotValue = window.currentSunspots || "Unknown";
      const utterance = new SpeechSynthesisUtterance(`Sunspot Number as of this time is ${sunspotValue}`);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
      console.log(getTimestamp(), `Speaking Sunspot Number: ${sunspotValue}`);
    };

    // Reads Kp-Index aloud using Web Speech API
    const speakKpIndex = () => {
      const kpValue = window.currentKp || "Unknown";
      const utterance = new SpeechSynthesisUtterance(`Kp-Index as of this time is ${kpValue}`);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
      console.log(getTimestamp(), `Speaking Kp-Index: ${kpValue}`);
    };

    // Reads D-Layer Absorption aloud using Web Speech API
    const speakDLayer = () => {
      const dLayerValue = window.currentDLayer || "Unknown";
      const utterance = new SpeechSynthesisUtterance(`D-Layer Absorption as of this time is ${dLayerValue}`);
      utterance.lang = 'en-US';
      speechSynthesis.speak(utterance);
      console.log(getTimestamp(), `Speaking D-Layer Absorption: ${dLayerValue}`);
    };

    // Event listeners
    document.getElementById('qrz-input').addEventListener('keypress', e => e.key === 'Enter' && searchQRZ());
    document.getElementById('solar-image').addEventListener('click', toggleSolarImageSize);
    document.getElementById('speak-sfi-button').addEventListener('click', speakSfi);
    document.getElementById('speak-a-index-button').addEventListener('click', speakAIndex);
    document.getElementById('speak-sunspot-button').addEventListener('click', speakSunspot);
    document.getElementById('speak-kp-button').addEventListener('click', speakKpIndex);
    document.getElementById('speak-d-layer-button').addEventListener('click', speakDLayer);

    // Set intervals for updates
    setInterval(updateClock, 1000);
    setInterval(fetchKpIndex, 3600000);
    setInterval(updateSolarData, 3600000);
    setInterval(updateSolarImage, 900000);
    updateClock();
    fetchKpIndex();
    updateSolarData();
    updateSolarImage();
  </script>
  <!-- 
    This code is a collaborative project between ChatGPT, DeepSeek, and Grok3, led by radio amateur LB6QJ.
    Techniques and languages used:
    - HTML5: Provides the structure of the dashboard
    - CSS3: Styles the layout using Flexbox and Grid, with high-contrast design for accessibility
    - JavaScript (ES6+): Handles dynamic content with async/await for API fetches, DOM manipulation, and event handling
    - Web Speech API: Enables text-to-speech functionality for accessibility
    - NOAA and NASA APIs: Fetches real-time solar and geomagnetic data
  -->
</body>
</html>
